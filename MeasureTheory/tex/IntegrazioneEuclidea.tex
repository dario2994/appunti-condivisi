\section{L'integrazione negli spazi Euclidei}
Approfondiamo ora la teoria dell'integrazione nell'ambientazione più classica: lo spazio $\R^n$ munito della misura di Lebesgue.

Mostreremo che l'integrale di Lebesgue non è che una generalizzazione dell'integrale di Riemann e che la misura prodotto definibile su $\R^n$ a partire dalla misura sulla retta reale coincide proprio con la misura $m_n$. Questi due risultati forniranno, a meno di applicare i teoremi di Fubini e Tonelli, i metodi primari per calcolare gli integrali in più dimensioni.

La seconda parte della sezione sarà completamente votata alla dimostrazione della formula del cambio di variabile, che necessita di un gran numero di lemmi e di un teorema, il teorema di Radon-Nikodym, che lasceremo indimostrato.

\begin{proposition}\label{prop:MisuraProdottoEuclidea}
	La \sigalg{} prodotto completata $\overline{\M_n\otimes\M_m}$ dei misurabili di $\R^n$ e $\R^m$ coincide con la \sigalg{} dei misurabili di $\R^{n+m}$.
\end{proposition}
\begin{proof}
	Lavoriamo sulla \sigalg{} prodotto \emph{non completata} $\M_n\otimes\M_m$, per poi ottenere l'enunciato ricordando che il completamento dei Boreliani sono i misurabili.

	Ricordando la \cref{def:LebesgueSemiaperti}, poiché valgono ovviamente i contenimenti $S_n\subseteq \M_n$ e $S_m\subseteq \M_m$, è facile ricavarne che $S_{n+m}\subseteq \M_n\otimes \M_m$.
	Ma allora, applicando la \cref{prop:SigAlgUgualeBoreliani} e ricordando che $\M_n\otimes \M_m$ è una \sigalg{}, otteniamo che i Boreliani sono contenuti in $\M_n\otimes\M_m$.
	
	Sia $E_1\times E_2\in \M_n\times\M_m$. Per il \cref{thm:LebesgueEquivalenzeMisurabilita}, esistono $A_1,A_2$ Boreliani e $N_1,N_2$ trascurabili, rispettivamente in $\R^n$ e $\R^m$, tali che $E_1=A_1\sqcup N_1$ e $E_2=A_2\sqcup N_2$.
	Perciò, grazie alla distributività del prodotto insiemistico rispetto all'unione disgiunta, otteniamo
	\begin{equation*}
		E_1\times E_2=(A_1\sqcup N_1)\times(A_2\sqcup N_2)=\left(A_1\times A_2\right)\sqcup\left(A_1\times N_2\sqcup A_2\times N_1 \sqcup N_1\times N_2\right) \punto
	\end{equation*}
	Però l'insieme $A_1\times N_2\sqcup A_2\times N_1 \sqcup N_1\times N_2$ è trascurabile per la \cref{prop:TrascurabilePerInsiemeTrascurabile} e l'insieme $A_1\times A_2$ è un Boreliano in quanto prodotto di Boreliani\footnote{Lasciamo al lettore la dimostrazione che il prodotto di Boreliani è un Boreliano.}, allora applicando ancora il \cref{thm:LebesgueEquivalenzeMisurabilita} si ottiene $E_1\times E_2\in\M_{n+m}$.
	Vista la generalità della scelta di $E_1\times E_2$, quanto appena mostrato implica che $\M_n\times\M_m\subseteq \M_{n+m}$ e visto che $\M_{n+m}$ è una \sigalg{} se ne ricava che $\M_n\otimes\M_m\subseteq \M_{n+m}$.
	
	Per quanto appena detto e poiché $\M_n\otimes\M_m$ contiene i Boreliani, ricordando la \cref{prop:CompletamentoBoreliani}, è ovvio concluderne che il suo completamento\footnote{È fondamentale notare che la misura indotta dal prodotto e la misura di Lebesgue coincidono in virtù della \cref{prop:UnicitaCaratheodory} e di conseguenza anche l'operatore di completamento di una \sigalg{} è coincidente.} $\overline{\M_n\otimes\M_m}$ coincide con l'insieme dei misurabili.
\end{proof}


\begin{proposition}\label{prop:IntegraleRiemannCoincide}
	Data una funzione $f:\cc ab\to \mathbb R$, se essa è integrabile secondo Riemann ed integrabile secondo Lebesgue allora i due integrali coincidono.
\end{proposition}
\begin{proof}
	Nel caso in cui la funzione sia integrabile secondo Riemann (e quindi anche limitata, dando senso agli $\inf,\sup$ che compariranno nelle formule), il valore dell'integrale secondo Riemann corrisponde all'estremo superiore delle somme inferiori alla Riemann\footnote{Indicheremo con $\int_a^b$ l'integrale di Riemann, e con $\int_{\cc ab}$ l'integrale di Lebesgue.}
	\begin{equation*}
		\int_a^b f(x)\de x=\sup\left\{\sum_{i=0}^{k-1} (x_{i+1}-x_i)\left(\inf_{t\in\co{x_i}{x_{i+1}}}f(t)\right):\ a=x_0<x_1<\cdots<x_{k-1}<x_k=b\right\} \virgola
	\end{equation*}
	ed anche all'estremo inferiore delle somme superiori alla Riemann
	\begin{equation*}
		\int_a^b f(x)\de x=\inf\left\{\sum_{i=0}^{k-1} (x_{i+1}-x_i)\left(\sup_{t\in\co{x_i}{x_{i+1}}}f(t)\right):\ a=x_0<x_1<\cdots<x_{k-1}<x_k=b\right\} \punto
	\end{equation*}
	
	Data una partizione $a=x_0<x_1<\cdots<x_{k-1}<x_k=b$ dell'intervallo $\cc ab$, definiamo le funzioni
	\begin{align*}
		f^-_{x_0,x_1,\dots,x_k}(x)=\sum_{i=0}^{k-1}\chi_{\co{x_i}{x_{i+1}}}(x)\cdot\inf_{t\in\co{x_i}{x_{i+1}}}f(t) \virgola \\
		f^+_{x_0,x_1,\dots,x_k}(x)=\sum_{i=0}^{k-1}\chi_{\co{x_i}{x_{i+1}}}(x)\cdot\sup_{t\in\co{x_i}{x_{i+1}}}f(t) \punto
	\end{align*}

	Con le definizioni mostrate è facile accorgersi che l'integrale di Riemann allora è l'estremo superiore dell'integrale di Lebesgue delle funzioni semplici $f^-_{x_0,\dots,x_k}$ su tutte le partizioni e analogamente l'estremo inferiore dell'integrale di Lebesgue delle funzioni semplici $f^+_{x_0,\dots,x_k}$ ancora su tutte le partizioni.
	Allora, per la monotonia dell'integrale di Lebesgue è facile accorgersi che
	\begin{multline*}
		\int_{\cc ab}f(x)\de x\le \\
		\inf_{a=x_0<\dots<x_k=b}\left\{\int_{\cc ab}f^+_{x_0,\dots,x_k}(x)\de x\right\}
		=\int_a^b f(x)\de x= 
		\sup_{a=x_0<\dots<x_k=b}\left\{\int_{\cc ab}f^-_{x_0,\dots,x_k}(x)\de x\right\}\\
		 \le \int_{\cc ab} f(x)\de x
	\end{multline*}
	e ciò equivale ovviamente alla tesi.
\end{proof}

Dimostriamo ora un caso particolare, ma molto significativo, della formula del cambio di variabile. 
Proviamo la formula per il cambio di variabile lineare che verrà poi sfruttata, attraverso una sorta di passaggio al limite, per dimostrare la formula più generale.

In particolare, e tale procedimento verrà ripetuto varie volte in questa sezione, prima otterremo un risultato sulla misura di un insieme trasformato da un'applicazione lineare per poi ricavarne facilmente la formula per il cambio di variabile attraverso l'applicazione della \cref{prop:IdentitaMisuraImplicaCambioVariabile}. L'idea che sta alla base di questo ragionamento è che l'identità riguardante le misure è in realtà un cambio di variabile riguardante le funzioni indicatrici.

\begin{proposition}\label{prop:IdentitaMisuraImplicaCambioVariabile}
	Fissato $A\in\M_n$, siano $\varphi:A\to\R^n$ una funzione che manda misurabili in misurabili e $\rho:A\to\Rpiu$ una funzione misurabile positiva tali che per ogni $E\subseteq A$ misurabile valga
	\begin{equation*}
		m_n\left(\varphi(E)\right)=\int_E\rho(x)\de x \punto
	\end{equation*}
	Allora per ogni funzione integrabile $f:\R^n\to\Rbar$ ed $E\subseteq A$ misurabile sono definiti i seguenti integrali e vale l'identità
	\begin{equation*}
		\int_{\varphi(E)}f(y)\de m_n(y)=\int_E f(\varphi(x))\rho(x)\de m_n(x)\punto
	\end{equation*}
\end{proposition}
\begin{proof}
	Fissato $E\subseteq A$ misurabile, sia $\mathcal F\subseteq \L(\R^n,\M_n,m_n)$ l'insieme delle funzioni che rispettano l'enunciato con tale $E$.
	
	Assumendo che $f$ sia l'indicatrice di un insieme misurabile finito $I\subseteq A$, applicando l'ipotesi sulla relazione tra $\varphi$ e $\rho$, otteniamo
	\begin{multline*}
		\int_{\varphi(E)} f(y)\de m_n(y)=\int_{\varphi(E)} \chi_I(y)\de m_n(y)=m_n(\varphi(E)\cap I)=m_n\left(\varphi(E\cap \varphi^{-1}(I))\right) \\
		=\int_{\varphi^{-1}(I)\cap E}\rho(x)\de m_n(x)=\int_E \chi_{\varphi^{-1}(I)}(x)\rho(x)\de m_n(x)=\int_E f(\varphi(x))\rho(x)\de m_n(x) \virgola
	\end{multline*}
	cioè $f$ appartiene a $\mathcal F$ e, vista la scelta arbitraria di $f$, tutte le funzioni indicatrici di insiemi finiti appartengono a $\mathcal F$.
	
	Per la linearità dell'operatore integrale è chiaro che l'insieme delle funzioni che rispettano è uno spazio vettoriale.
	
	Sia ora $(f_n)_{n\in\N}\subseteq \mathcal F$ una successione di funzioni che converge monotonamente alla funzione integrabile $f$. Possiamo assumere senza perdità di generalità, visto che basterebbe cambiare segno, che la convergenza sia crescente.
	
	Dall'ipotesi $f_n\in\mathcal F$ abbiamo che
	\begin{equation}\label{eq:IMICV_UguaglianzaFinita}
		\int_{\varphi(E)} f_n(y)\de y = \int_E f_n(\varphi(x))\rho(x)\de x\punto
	\end{equation}
	Notando che, per l'ipotesi di convergenza monotona, le funzioni $f_n$ sono dominate dalla funzione integrabile $\max(|f_1|,|f|)$, applicando il \cref{thm:ConvergenzaDominata}, ricaviamo il limite
	\begin{equation}\label{eq:IMICV_LimiteFacile}
		\lim_{n\to\infty} \int_{\varphi(E)} f_n(y)\de y = \int_{\varphi(E)} f(y) \de y\punto
	\end{equation}
	Definiamo ora, per ogni $n\in\N$, la funzione misurabile positiva $g_n(x)=f_n(\varphi(x))\rho(x)-f_1(\varphi(x))\rho(x)$ e definiamo anche la funzione $g(x)=f(\varphi(x))\rho(x)-f_1(\varphi(x))\rho(x)$.
	La successione $(g_n)_{n\in\N}$, in virtù del fatto che le funzioni $f_n$ convergono crescentemente a $f$, converge crescentemente alla funzione $g$.
	Allora, applicando il \cref{thm:BeppoLevi}, possiamo affermare
	\begin{equation*}
		\int_E g(x)\de x=\lim_{n\to\infty} \int_E g_n(x)\de x
	\end{equation*}
	e sommando ad ambo i membri l'integrale di $f_1(\varphi(x))\rho(x)$, che esiste finito poiché $f_1\in\mathcal F$, otteniamo
	\begin{equation}\label{eq:IMICV_LimiteDifficile}
		\int_E f(\varphi(x))\rho(x)\de x=\lim_{n\to\infty} \int_E f_n(\varphi(x))\rho(x)\de x \punto
	\end{equation}
	A questo punto, unendo le \cref{eq:IMICV_UguaglianzaFinita,eq:IMICV_LimiteFacile,eq:IMICV_LimiteDifficile}, arriviamo a
	\begin{equation*}
		\int_{\varphi(E)} f(y)\de y=\int_E f(\varphi(x))\rho(x)\de x\virgola
	\end{equation*}
	cioè $f\in\mathcal F$ e quindi, per l'arbitrarietà della successione $f_n$ scelta, abbiamo dimostrato che $\mathcal F$ è chiusa per convergenza monotona (ammesso di rimanere nelle integrabili).
	
	Unendo quanto detto, abbiamo tutte le ipotesi per applicare il \cref{thm:ChiusuraMonotonaFunzioni}\footnote{Bisogna notare che qui sfruttiamo una versione leggermente diversa dell'enunciato, la cui dimostrazione è analoga. Infatti noi ci interessiamo ad ottenere che $\mathcal F$ coincida con le funzioni integrabili, non con tutte le misurabili. 
	Perciò l'enunciato del teorema utilizzato andrebbe modificato aggiungendo il fatto che la convergenza monotona sia ristretta nelle integrabili.} e ottenerne quindi che $\mathcal F=\L(\R^n,\M_n,m_n)$, cioè la tesi.
\end{proof}

\begin{proposition}\label{prop:MisuraImmagineLineare}
	Fissata un'applicazione lineare $L:\R^n\to\R^n$, per ogni $E\in\M_n$ misurabile secondo Lebesgue risulta che $L(E)$ è misurabile e rispetta
	\begin{equation}
		m_n(L(E))=\lvert \det L\rvert\cdot m_n(E)\punto
	\end{equation}
\end{proposition}
\begin{proof}
	La funzione $L$ essendo lineare è in particolare lipschitziana (con costante la propria norma) quindi, applicando la \cref{prop:LipschitzTengonoMisurabili}, otteniamo che per ogni $E$ misurabile, $L(E)$ è anch'esso misurabile.
	
	Consideriamo ora la funzione $\mu_L:\M_n\to\Rpiu$ definita come $\mu_L(E)=m_n(L(E))$. Per quanto appena mostrato questa è una buona definizione.
	Per la \cref{prop:BigettivaInduceMisura} la $\mu_L$ è una misura.
	Inoltre, ricordando che la misura di Lebesgue è invariante per traslazione come mostrato nella \cref{nota:LebesgueProprieta}, si ottiene
	\begin{equation*}
		\forall v\in\R^n:\ \mu_L(E+v)=m_n(L(E+v))=m_n(L(E)+Lv)=m_n(L(E))=\mu_L(E)
	\end{equation*}
	che equivale a dire che $\mu_L$ è invariante per traslazione.
	\newcommand{\linR}{\ensuremath{\mathcal L(\R^n,\R^n)}}
	Allora possiamo applicare il \cref{thm:LebesgueUnicaInvarianteTraslazione}\footnote{Il teorema ci assicura l'identità delle misure solo sui Boreliani, ma i misurabili sono il completamento dei Boreliani e perciò le due misure coincidono anche sui misurabili.} ottenendo che esiste una funzione $c:\linR\to\Rpiu$ con dominio le applicazioni lineari, tale che valga
	\begin{equation}\label{eq:DefQuasiDet}
		\forall L\in \linR,\ E\in\M_n:\ \mu_L(E)=c(L)m_n(E)\punto
	\end{equation}
	
	Mostriamo ora che $c(\cdot)$ è moltiplicativa e che coindice con il valore assoluto del determinante sulle applicazioni diagonali e ortogonali. Da questo, sfruttando una decomposizione nota delle applicazioni lineari di $\R^n$, seguirà che coincide con il valore assoluto del determinante su ogni applicazione lineare e questo è proprio quanto richiesto dalla tesi. 
	
	Fissate $A,B\in \linR$ applicazioni lineari ed $E\in\M_n$ un misurabile non trascurabile, applicando unicamente l'\cref{eq:DefQuasiDet} risulta
	\begin{align*}
		c(AB)m_n(E)&=\mu_{AB}(E)=m_n(AB(E))=m_n(A(B(E))\\
		&=\mu_A(B(E))=c(A)m_n(B(E))=c(A)\mu_B(E)=c(A)c(B)m_n(E)\virgola
	\end{align*}
	da cui si ricava $c(AB)=c(A)c(B)$ dividendo per $m_n(E)$. Perciò $c$ è moltiplicativa.
	
	Sia $D\in\linR$ un'applicazione diagonale, in particolare siano $(\lambda_i)_{1\le i\le n}$ i valori sulla diagonale.
	Allora è facile ricavare
	\begin{equation*}
		D\left(\co01\times\co01\times\dots\times\co01\right)=\co0{\lambda_1}\times\co0{\lambda_2}\times\cdots\times\co0{\lambda_n}\virgola
	\end{equation*}
	da cui, applicando ad entrambi i membri la misura di Lebesgue, si ottiene
	\begin{align*}
		c(D)&=c(D)m_n\left(\co01\times\dots\times\co01\right)=\mu_D\left(\co01\times\dots\times\co01\right)\\
		&=m_n\left(\co0{\lambda_1}\times\cdots\times\co0{\lambda_n}\right)=
		\lvert\lambda_1\rvert\cdot\lvert\lambda_2\rvert\cdots\lvert\lambda_n\rvert=\lvert\det(D)\rvert
	\end{align*}
	che equivale a dire che $c(\cdot)$ e $\lvert\det(\cdot)\rvert$ coincidono sulle matrici diagonali.
	
	Fissata un'applicazione $O\in\linR$ ortogonale, chiamando $P$ la palla unitaria di $\R^n$ è ovvio che $O(P)=P$.
	Da questo, applicando ad entrambi i membri la misura di Lebesgue, si ricava $\mu_O(P)=m_n(P)$ e, ricordando che $P$ non è trascurabile, ne discende $c(O)=1$.
	Ma $O$ è ortogonale, quindi $\det O=\pm 1$ e allora è dimostrato anche in questo caso $\lvert\det O\rvert =c(O)$.
	
	Infine, data un'applicazione lineare generica $L\in\linR$, sia $L=OS$ la sua decomposizione polare\footnote{La si ottiene notando che $LL^t$ è una matrice simmetrica definita positiva che perciò ammette una ``radice quadrata''.} dove $O$ è ortogonale e $S$ è simmetrica. Per il teorema spettrale esistono $P,D$ rispettivamente invertibile e diagonale tali che $S=PDP^{-1}$.
	Ricordando le proprietà che rispetta la funzione $c$ e la moltiplicatività del determinante, ricaviamo
	\begin{align*}
		c(L)&=c(OPDP^{-1})=c(O)c(P)c(D)c(P^{-1})=c(O)c(D)c(P)c(P^{-1})\\
		&=c(O)c(D)c(PP^{-1})=\lvert\det O\rvert\cdot\lvert\det D\rvert=\lvert \det(OPDP^{-1})\rvert=\lvert\det L\rvert \virgola
	\end{align*}
	che è equivale a dire che $c(\cdot)$ e $\lvert\det(\cdot)\rvert$ coincidono come si voleva.
\end{proof}

\begin{corollary}\label{cor:CambioVariabileLineare}
	Fissata un'applicazione lineare $L:\R^n\to\R^n$, per ogni $E\in\M_n$ misurabile ed $f:\R^n\to\Rbar$ integrabile vale la formula per il cambio di variabile lineare
	\begin{equation*}
		\int_{L(E)}f(y)\de m_n(y) = \int_E f(L(x))\left\lvert\det L\right\rvert \de m_n(x) \punto
	\end{equation*}
\end{corollary}
\begin{proof}
	È un'ovvia conseguenza della \cref{prop:IdentitaMisuraImplicaCambioVariabile}, visto che le ipotesi di quest'ultima sono verificate dalla \cref{prop:MisuraImmagineLineare}.
\end{proof}

I fatti seguenti sono tutti mirati a fornire basi solide ai vari procedimenti di limite necessari per ottenere la formula per il cambio di variabile.
In particolare la continuità $L^1$, così è nota in letteratura la \cref{prop:ContinuitaL1}, oltre ad essere il fondamento di tutti gli altri lemmi è importante anche al di là di questa dimostrazione. È infatti un fatto assolutamente non ovvio che rende possibile ottenere tutti i risultati riguardo la convoluzione integrale.

Bisogna porre un accento sul fatto che la dimostrazione della continuità $L^1$ ricalca quella che vuole essere la struttura di tutte le dimostrazioni fondazionali della teoria della misura: si inizia dimostrando l'enunciato per insiemi nel \semiring{} per poi concludere che vale per ogni misurabile attraverso l'applicazione di chiusure monotone.



\begin{lemma}\label{lemma:ContinuitaL1Semianello}
	Dato $T=\co{a_1}{b_1}\times\cdots\times\co{a_n}{b_n}\in\S_n$ e $c=(c_1,\dots,c_n)\in\R^n$, vale la stima
	\begin{equation*}
		\LNorm{\chi_T({}\cdot{}+c)-\chi_T({}\cdot{})}\le 2m_n(T)\sum_{i=1}^n \frac{\lvert c_i\rvert }{b_i-a_i} \punto
	\end{equation*}
\end{lemma}
\begin{proof}
	Definiamo la funzione misurabile $s_c:\R^n\to\R$ come $s_c(x)=\left\lvert\chi_T(x+c)-\chi_T(x)\right\rvert$.
	
	Sfruttando delle identità insiemistiche e la definizione delle funzioni caratteristiche, è facile verificare che
	\begin{equation*}
		s_c(x)=\chi_{T\setminus\left(T-c\right)}(x)+\chi_{\left(T-c\right)\setminus T}(x)\punto
	\end{equation*}
	Inoltre i due insiemi $T\setminus\left(T-c\right)$ e $\left(T-c\right)\setminus T$ hanno la stessa misura in virtù della \cref{prop:LebesgueProprietaIsometria}, in quanto si può ottenere l'uno dall'altro, a meno del bordo che è però trascurabile, con un'isometria.
	Unendo quanto detto e ricordando che l'integrale di una caratteristica è la misura dell'insieme, è evidente la validità della formula
	\begin{equation} \label{eq:IdentitaIntegraleContinuitaL1}
		\LNorm{s_c}=2m_n\left(T\setminus\left(T-c\right)\right)\punto
	\end{equation}
	
	Vogliamo quindi stimare la misura di $T\setminus\left(T-c\right)$. 
	Se $x=(x_1,\dots,x_n)\in\R^n$ appartiene a $T\setminus\left(T-c\right)$ allora $x\in T$ e $x\not\in T-c$. Ma tali appartenenze, passando in coordinate, divengono il seguente sistema:
	\begin{equation}\label{eq:SistemaSemianelloContinuitaL1}
		\begin{cases}
			\forall i\in\{1,\dots,n\}: &a_i\le x_i<b_i \virgola\\
			\exists j\in\{1,\dots,n\}: &x_j<a_j-c_j \vee b_j-c_j\le x_j \punto
		\end{cases}
	\end{equation}
	Definiamo quindi $T_j$, con $j\in\{1,\dots,n\}$, come l'insieme dei punti che rispettano il sistema dove la proprietà nella seconda riga è rispettata da $j$.
	Allora, per la subadditività della misura di Lebesgue, vale
	\begin{equation}\label{eq:StimaInsiemeConPezzettiContinuitaL1}
		T\setminus\left(T-c\right)\subseteq \bigcup_{j=1}^n T_j \implies m_n\left(T\setminus\left(T-c\right)\right)\le \sum_{j=1}^n m_n(T_j) \punto
	\end{equation}
	Preso $x\in T_j$ se $c_j\ge 0$, come conseguenza dell'\cref{eq:SistemaSemianelloContinuitaL1}, vale $b_j-c_j\le x_j<b_j$; mentre se $c_j<0$ risulta $a_j\le x_j<a_j-c_j$. Sia allora $I$ l'intervallo $\co{b_j-c_j}{b_j}$, nel caso in cui $c_j\ge 0$, e $\co{a_j}{a_j-c_j}$ altrimenti. In entrambi i casi la lunghezza di $I$ risulta essere $\lvert c_j \rvert$.
	Per quanto detto, ricordando ancora l'\cref{eq:SistemaSemianelloContinuitaL1} è facile accorgersi che vale
	\begin{equation*}
		T_j\subseteq \co{a_1}{b_1}\times\cdots\times\co{a_{j-1}}{b_{j-1}}\times I\times\co{a_{j+1}}{b_{j+1}}\times\cdots\times \co{a_n}{b_n}
	\end{equation*}
	e da questa, per la definizione della misura di Lebesgue su $\S_n$ è ovvio ricavarne
	\begin{equation}\label{eq:StimaFinalePezzettoContinuitaL1}
		m_n(T_j)\le \frac{\lvert c_j\rvert }{b_j-a_j} \prod_{i=1}^n (b_i-a_i)=\frac{\lvert c_j\rvert }{b_j-a_j} m_n(T) \punto
	\end{equation}
	
	Unendo le \cref{eq:IdentitaIntegraleContinuitaL1,eq:StimaInsiemeConPezzettiContinuitaL1,eq:StimaFinalePezzettoContinuitaL1} arriviamo finalmente ad avere
	\begin{equation*}
		\LNorm{s_c}\le 2m_n(T)\sum_{i=1}^n \frac{\lvert c_i\rvert }{b_i-a_i}\virgola
	\end{equation*}
	che implica che la tesi per definizione di $s_c$.
\end{proof}


\begin{proposition}[Continuità $L^1$]\label{prop:ContinuitaL1}
	Data una funzione $f:\R^n\to\Rbar$ integrabile nella misura di Lebesgue, le funzioni $f({}\cdot{}+c)$ convergono, per $c$ che tende a $0$, in norma $L^1$ ad $f$.
\end{proposition}
\begin{proof}
	Sia $\mathcal F\subseteq \L(\R^n,\M_n,m_n)$ l'insieme delle funzioni integrabili per cui l'enunciato è vero.
	Chiamiamo poi, per $c\in\R^n$, $\tau_c:\R^n\to\R^n$ la traslazione $\tau_c(x)=x+c$.
	
	Dimostreremo che le funzioni indicatrici di $\S_n$ appartengono ad $\mathcal F$, poi che $\mathcal F$ è uno spazio vettoriale chiuso per convergenza puntuale ed infine che se due funzioni coincidono quasi ovunque ed una appartiene ad $\mathcal F$ allora anche l'altra vi appartiene. 
	L'unione di questi fatti sarà sufficiente a mostrare che $\mathcal F=\L(\R^n,\M_n,m_n)$ dimostrando così la tesi.
	
	Il \cref{lemma:ContinuitaL1Semianello} dimostra banalmente, considerando il limite per $c\to 0$, che le indicatrici degli insiemi in $\S_n$ appartengono ad $\mathcal F$.
	
	Il fatto che $\mathcal F$ sia uno spazio vettoriale discende direttamente dalla linearità dell'integrale e dal fatto che il limite di una somma è la somma dei limiti.
	
	Sia $(f_n)_{n\in\N}$ una successione di funzioni integrabili che appartengono ad $\mathcal F$ convergenti monotonamente alla funzione $f$, che assumiamo essere integrabile.
	Per il \cref{thm:ConvergenzaDominata}, le cui ipotesi sono facilmente verificate poiché le funzioni sono dominate dalla funzione integrabile $\max(f,f_1)$, le $f_n$ convergono ad $f$ anche in norma $L^1$ e perciò, per ogni $\epsilon>0$, esiste $m\in\N$ tale che $\LNorm{f_m-f}<\epsilon$. 
	Inoltre, una facile conseguenza dell'invarianza per traslazione della misura di Lebesgue è 
	\begin{equation*}
		\LNorm{f_m\circ\tau_c-f\circ\tau_c}=\LNorm{f_m-f} \virgola
	\end{equation*}
	da cui, poiché $\LNorm{{}\cdot{}}$ rispetta la triangolare come mostrato nella \cref{prop:L1VettorialeConSeminorma}, ne otteniamo
	\begin{equation*}
		\LNorm{f\circ\tau_c-f}\le \LNorm{f_m\circ\tau_c-f\circ\tau_c}+\LNorm{f_m-f}+\LNorm{f_m\circ\tau_c-f_m} \le 2\epsilon+\LNorm{f_m\circ\tau_c-f_m}\virgola
	\end{equation*}
	che passando al massimo limite entrambi i membri e ricordando che $f_n\in\mathcal F$, implica la disuguaglianza
	\begin{equation*}
		\limsup_{c\to 0} \LNorm{f\circ\tau_c-f} \le 2\epsilon \punto
	\end{equation*}
	Ma quest'ultima disuguaglianza vale per ogni $\epsilon>0$ e ciò implica ovviamente che anche $f\in\mathcal F$.
	
	Date $f,g:\R^n\to\Rbar$ funzioni integrabili equivalenti in $L^1$, con $f\in\mathcal F$, dimostriamo che $g\in\mathcal F$. 
	Anche $f\circ\tau_c$ e $g\circ\tau_c$ sono equivalenti in $L^1$ e perciò anche $f\circ\tau_c-f$ coincide quasi ovunque con $g\circ\tau_c-g$.
	Unendo quanto detto si ottiene
	\begin{equation*}
		\LNorm{g\circ\tau_c-g}=\LNorm{f\circ\tau_c-f}\to 0 \virgola
	\end{equation*}
	che implica che anche $g$ appartiene a $\mathcal F$.
	
	Sia $\mathcal E$ la famiglia degli insiemi tali che le loro indicatrici appartengono ad $\mathcal F$. 
	
	Abbiamo mostrato che $\S_n\subseteq \mathcal E$. 
	Inoltre il fatto che $\mathcal F$ sia uno spazio vettoriale implica che $\mathcal E$ sia stabile per unione disgiunta e, essendo $\mathcal F$ chiuso per convergenza puntuale nelle funzioni integrabile, $\mathcal E$ risulta stabile per unione e intersezione monotona numerabile negli insiemi finiti.
	Quindi risultano verificate le ipotesi del \cref{cor:ChiusuraMonotonaInsiemiFiniti} e ne deduciamo che $\mathcal E$ contiene ogni misurabile finito a meno di un trascurabile. Ma il fatto che se $\mathcal F$ contiene una funzione allora contiene ogni funzione che coincide quasi ovunque con essa implica che $\mathcal E$ se contiene un insieme allora contiene anche quelli che coincidono con lui a meno di un trascurabile.
	Quindi questo implica $\mathcal E$ contiene tutti gli insiemi misurabili finiti e perciò $\mathcal F$ contiene le loro indicatrici.
	
	Concludiamo quindi applicando il \cref{thm:ChiusuraMonotonaFunzioni}\footnote{Di nuovo sfruttiamo l'enunciato nella forma con insiemi finiti e funzioni integrabili.}, di cui abbiamo controllato essere verificate tutte le ipotesi, e otteniamo che $\mathcal F$ contiene tutte le funzioni integrabili.
\end{proof}

\begin{definition}[Media integrale] \label{def:MediaIntegrale}
	Definiamo l'operatore $\aint$, chiamato media integrale, come
	\begin{equation*}
		\aint_E f(x)\de\mu(x)=\frac 1{\mu(E)}\int_E f(x)\de\mu(x)\virgola
	\end{equation*}
	dove $E$ è un insieme misurabile nello spazio di misura $(X,\A,\mu)$ e $f:X\to\Rbar$ è una funzione integrabile nel medesimo spazio di misura.
\end{definition}
\begin{remark}\label{nota:ProprietaMediaIntegrale}
	Fissato uno spazio di misura $(X,\A,\mu)$ e un insieme misurabile $E\in\A$ l'operatore di media integrale rispetta le seguenti proprietà:
	\begin{itemize}
		\item Date $f,g:X\to\Rbar$ funzioni misurabili e $a,b\in\R$ vale
		\begin{equation*}
			a\aint_E f(x)\de\mu(x)+b\aint_E g(x)\de\mu(x)=\aint_E af(x)+bg(x)\de\mu(x)
		\end{equation*}
		e se $f\le g$ allora
		\begin{equation*}
			\aint_E f(x)\de\mu(x)\le \aint_E g(x)\de\mu(x)\virgola
		\end{equation*}
		cioè la media integrale è lineare e monotona.
		\item Fissato $c\in\R$ vale
		\begin{equation*}
			\aint_E c\de\mu(x)=c\punto
		\end{equation*}
		\item Per ogni $f:X\to\Rbar$ misurabile valgono le stime
		\begin{equation*}
			\inf_{x\in E}f(x)\le \aint_E f(x)\de\mu(x) \le \sup_{x\in E}f(x)\punto
		\end{equation*}
	\end{itemize}
\end{remark}
\begin{proof}
	La linearità, la monotonia e l'identità riguardante la media integrale delle costanti discendono dalla \cref{def:MediaIntegrale} applicando le prime proprietà dell'integrale di Lebesgue.
	
	Per quanto riguarda l'ultima stima, è sufficiente applicare le proprietà già dimostrate per ottenere
	\begin{equation*}
		\inf_{x\in E}f(x) = \aint_E \inf_{x\in E} f(x)\de\mu(x)\le \aint_E f(x)\de\mu(x) \le \aint_E \sup_{x\in E} f(x)\de\mu(x) =\sup_{x\in E}f(x)\punto
	\end{equation*}
\end{proof}


\begin{lemma}\label{lemma:ContinuitaL1Palle}
	Fissato $E\in\M_n$ un insieme misurabile e $f:E\to\Rbar$ una funzione integrabile, definiamo, per ogni $r>0$, la funzione $f_r:E\to\Rbar$ come
	\begin{equation*}
		\forall x\in E:\ f_r(x)=\frac{\int_{B_r(x)\cap E}f(t)\de t}{m_n\left(B_r(x)\right)}\virgola
	\end{equation*}
	dove $B_r(x)$ è la palla aperta di raggio $r$ e centro $x$.
	Allora le funzioni $f_r$, che risultano essere continue, convergono, per $r$ che tende a $0$, in norma $L^1$ alla funzione $f$.
\end{lemma}
\begin{proof}
	Innanzitutto, per comodità di notazione, allarghiamo il dominio della $f$ ponendo $f(E^{\mathsf c})=\{0\}$, così facendo otteniamo
	\begin{equation*}
		\forall r>0,\ x\in E:\ f_r(x)=\frac{\int_{B_r(x)}f(t)\de t}{m_n(B_r(x))}=\aint_{B_r(x)} f(t)\de t \punto
	\end{equation*}

	Vale facilmente, per ogni $x,y\in E$, l'identità
	\begin{equation*}
		\lvert f_r(x)-f_r(y)\rvert %= \left\lvert \aint_{B_r(x)}f(t)\de t-\aint_{B_r(y)} f(t)\de t\right\rvert 
		\le \aint_{B_r(x)}\lvert f(t)-f(t+(y-x))\rvert \de t \le \frac{ \LNorm{f({}\cdot{})-f({}\cdot{}+(y-x))} }{ m_n(B_r(0)) } \virgola
	\end{equation*}
	che grazie alla \cref{prop:ContinuitaL1} implica la continuità delle funzioni $f_r$.
	
	Ora verifichiamo, per poi poter applicare il teorema di Tonelli, che la funzione $g:\R^n\times\R^n\to\Rbar$ definita come $g(x,t)=f(x+t)-f(x)$ è misurabile nello spazio prodotto $\R^n\times\R^n$. 
	La funzione $u(x,t)=f(x)$ è misurabile nel prodotto grazie alla \cref{nota:FunzioniMisProdotto} e allora anche $u(x+t,t)$ lo è in quanto composizione di una misurabile con una lineare invertibile. Unendo quanto detto si ha, come cercato, che $g(x,t)=u(x+t,t)-u(x,t)$ è misurabile in quanto differenza di misurabili.
	
	Calcoliamo ora la norma $L^1$ della differenza tra $f$ e $f_r$:
	\begin{multline}\label{eq:ContinuitaPalleDis}
		\LNorm{f-f_r}=\int_E \left\lvert f(x)-\aint_{B_r(x)}f(t)\de t\right\rvert\de x\\
		=\int_E\left\lvert\aint_{B_r(x)}f(x)-f(t)\de x\right\rvert\de t\le \int_E\aint_{B_r(x)}\left\lvert f(x)-f(t)\right\rvert\de x\de t\\
		=\int_E\aint_{B_r(0)}\left\lvert f(x)-f(x+h)\right\rvert\de h\de x
		=\aint_{B_r(0)}\int_E \left\lvert f(x)-f(x+h)\right\rvert\de x\de h\\
		= \aint_{B_r(0)}\LNorm{f(\cdot)-f(\cdot+h)}\de h\le \sup_{h\in B_r(0)} \LNorm{f(\cdot)-f(\cdot+h)}\virgola
	\end{multline}
	dove nei vari passaggi abbiamo sfruttato il \cref{thm:TonelliCompleto}, che si può applicare ricordando la \cref{prop:MisuraProdottoEuclidea}, e la \cref{nota:ProprietaMediaIntegrale}.
	
	Per la \cref{prop:ContinuitaL1}, il valore $\sup_{h\in B_r(0)} \LNorm{f(\cdot)-f(\cdot+h)}$ tende a $0$ per $r\to 0$ e applicando ciò nell'\cref{eq:ContinuitaPalleDis} si ricava facilmente la tesi.
\end{proof}

Terminati i lemmi preliminari, mostriamo ora la formula per il cambio di variabile. La dimostrazione procede in tre passi. 
In un primo passo, cioè nel \cref{lemma:LimiteDeterminante}, proviamo solo una disuguaglianza, che poi mostreremo essere un'uguaglianza nel \cref{lemma:MisuraImmagine} e che sarà l'equivalente della \cref{prop:MisuraImmagineLineare} ma nel caso generale e non in quello lineare. Infine il terzo passo semplicente trasforma l'enunciato sulla misura di un insieme nella formula per il cambio di variabile.

Per passare da disuguaglianza a uguaglianza sfrutteremo come strumento fondamentale il teorema di Radon-Nikodym, che asserisce che ogni misura ammette una ``densità'', cioè una funzione tale che il suo integrale su un insieme, rispetto ad un'altra misura, coincide con la misura dell'insieme.
Tale teorema lo lasciamo indimostrato fondamentalmente per la non banalità della dimostrazione e poiché in queste dispense lo useremo solo come strumento tecnico, senza approfondire l'argomento.

\begin{lemma}\label{lemma:LimiteDeterminante}
	Fissato $\Omega\subseteq\R^n$ un aperto, sia $\varphi:\Omega\to\R^n$ una funzione differenziabile con continuità.
	Allora vale la seguente disuguaglianza:
	\begin{equation*}
		\forall x\in\Omega:\ \limsup_{r\to 0} \frac{ m_n\left(\varphi\left(B_r(x)\right)\right)} {m_n\left(B_r(x)\right)}\le \lvert\det D\varphi(x)\rvert \virgola 
	\end{equation*}
	dove $B_r(x)$ è la palla aperta di raggio $r$ e centro $x$ e $D\varphi$ è la matrice jacobiana della funzione $\varphi$.
\end{lemma}
\begin{proof}
	Fissiamo $\bar x\in\Omega$ e chiamiamo $A=D \varphi(\bar x)$.
	Allora, per definizione di differenziale, risulta vero che
	\begin{equation*}
		\varphi(\bar x+h)=\varphi(\bar x)+Ah+\smallO(h)=\varphi(\bar x)+A(h+\smallO(h))\in \varphi(\bar x)+A\left(B_{|h|+\smallO(h)}(0)\right) \virgola
	\end{equation*}
	dove abbiamo implicitamente sfruttato che moltiplicare per la norma degli operatori di $A$ non cambia il fatto che una funzione sia $\smallO$-piccolo di un'altra.
	
	Da quanto appena detto discende facilmente che, per ogni $r>0$, vale
	\begin{equation}\label{eq:ContenimentoPallaLineare}
		\varphi(B_r(\bar x))\subseteq \varphi(\bar x)+A\left(B_{r+\smallO(r)}(0)\right).
	\end{equation}
	Essendo però $\varphi$ differenziabile con continuità, è anche localmente lipschitziana e perciò, per il \cref{cor:LocLipschitzTengonoMisurabili}, l'insieme $\varphi(B_r(\bar x))$ è misurabile.
	Allora possiamo applicare la misura di Lebesgue ad entrambi i membri del contenimento mostrato nell'\cref{eq:ContenimentoPallaLineare} ottenendo
	\begin{equation}\label{eq:StimaImmaginePalla}
		m_n\left( \varphi(B_r(\bar x)) \right)\le m_n\left(\varphi(\bar x)+A\left(B_{r+\smallO(r)}(0)\right)\right)
		=\lvert \det A\rvert m_n\left(B_{r+\smallO(r)}(\bar x)\right)\virgola
	\end{equation}
	dove i passaggi sono giustificati dall'invarianza per traslazione della misura di Lebesgue e dalla \cref{prop:MisuraImmagineLineare}.
	Ma ora, grazie alla $n$-omogeneità della misura $m_n$, ricaviamo
	\begin{equation*} 
		m_n\left(B_{r+\smallO(r)}(\bar x)\right)=\left(1+\smallO(1)\right)^n m_n\left( B_r(\bar x)\right)
	\end{equation*}
	e perciò sostituendo questa nell'\cref{eq:StimaImmaginePalla} arriviamo a
	\begin{equation*}
		m_n\left( \varphi(B_r(\bar x)) \right)\le \left(1+\smallO(1)\right)^n m_n\left( B_r(\bar x)\right)\lvert \det A\rvert \virgola
	\end{equation*}
	che implica banalmente la tesi.
\end{proof}

\begin{definition}\label{def:AssolutamenteContinua}
	Date due misure $\mu:\A\to\Rpiu,\ \nu:\A\to\Rpiu$ sullo stesso spazio misurabile $(X,\A)$, diciamo che $\nu$ è assolutamente continua rispetto a $\mu$, indicandolo con $\nu\ll\mu$, se per ogni $E\in\A$ tale che $\mu(E)=0$ vale $\nu(E)=0$, cioè se tutti gli insiemi trascurabili per $\mu$ sono trascurabili anche per $\nu$.
\end{definition}

\begin{theorem}[Radon-Nikodym] \label{thm:RadonNikodym}
	Dato uno spazio di misura $(X,\A,\mu)$ \sigfin[o], se la misura $\nu:\A\to\Rpiu$ è assolutamente continua rispetto a $\mu$, allora esiste una funzione $\rho:X\to\Rpiu$ misurabile rispetto a $\mu$, tale che
	\begin{equation*}
		\forall A\in\A:\ \nu(A)=\int_A \rho(x)\de\mu(x)\punto
	\end{equation*}
\end{theorem}

\begin{lemma}\label{lemma:MisuraImmagine}
	Fissati $\Omega,\Omega'\subseteq\R^n$ due aperti, sia $\varphi:\Omega\to\Omega'$ un diffeomorfismo $C^1$.
	Allora, per ogni $E\subseteq \Omega$ misurabile vale
	\begin{equation*}
		m_n(\varphi(E))=\int_E\left\lvert \det D\varphi(x) \right\rvert \de m_n(x)\virgola
	\end{equation*}
	dove $D\varphi$ è la matrice jacobiana del diffeomorfismo $\varphi$.
\end{lemma}
\begin{proof}
	La funzione $\varphi$, essendo $C^1$, è localmente lipschitziana e di conseguenza, applicando il \cref{cor:LocLipschitzTengonoMisurabili}, manda misurabili in misurabili e trascurabili in trascurabili.
	
	Allora per la \cref{prop:BigettivaInduceMisura} la funzione di insiemi $\nu=m_n\circ \varphi$ è una misura, che risulta essere assolutamente continua rispetto alla misura di Lebesgue poiché $\varphi$ manda trascurabili in trascurabili.
	Perciò, per il \cref{thm:RadonNikodym}, esiste una funzione $\rho:\Omega\to\Rpiu$ misurabile positiva tale che
	\begin{equation*}
		\forall E\in \M_n\virgola E\subseteq \Omega:\ m_n(\varphi(E))=\int_E \rho \de x \punto
	\end{equation*}
	Per la \cref{prop:IdentitaMisuraImplicaCambioVariabile} questo implica che vale anche la formula
	\begin{equation}\label{eq:CambioRadonNikodym}
		\forall E\in \M_n\virgola E\subseteq\Omega:\ \int_{\varphi(E)} f(y)\de y = \int_{E} f(\varphi(x))\rho(x) \de x
	\end{equation}
	per ogni $f:\Omega'\to\Rbar$ integrabile.
	
	Fissato $K\subseteq\Omega$ compatto, poichè $\varphi$ è continua, anche $\varphi(K)$ è compatto e perciò in particolare ha misura finita.
	Allora, per la definizione stessa di $\rho$, la funzione $\bar\rho=\chi_K\cdot\rho$ è integrabile.
	
	A questo punto, usando la medesima notazione dell'enunciato del \cref{lemma:ContinuitaL1Palle}, definiamo le funzioni $\rho_r, \bar\rho_r$ e notiamo che
	\begin{equation*}
		\rho_r(x)=\aint_{B_r(x)}\rho(t)\de t=\frac{\int_{B_r(x)} \rho(t)\de t}{m_n(B_r(0))}=\frac{m_n(\varphi(B_r(x)))}{m_n(B_r(0))}\punto
	\end{equation*}
	
	Applichiamo allora il \cref{lemma:ContinuitaL1Palle} alla funzione $\bar\rho$, ottenendo che $\bar\rho_r$ converge a $\bar\rho$ in norma $L^1$.
	E di conseguenza, per la \cref{prop:L1ImplicaSottosuccessioneQuasiOvunque}, questo implica che, a meno di estrarre sottosuccessioni, $\bar\rho_r$ converge puntualmente quasi ovunque a $\bar\rho$.
	Allora, visto che il limite superiore è maggiore del limite di ogni sottosuccessione, abbiamo ottenuto che per quasi ogni $x\in K$ vale
	\begin{equation*}
		\bar\rho(x)\le \limsup_{r\to 0} \bar\rho_r(x)\virgola
	\end{equation*}
	ma per $x$ nella parte interna di $K$ i valori $\bar\rho_r(x)$ e $\rho_r(x)$ coincidono per $r$ sufficientemente piccolo, quindi per quasi ogni $x$ nella parte interna di $K$ abbiamo la disuguaglianza
	\begin{equation*}
		\rho(x)\le \limsup_{r\to 0} \rho_r(x)=\limsup_{r\to 0} \frac{m_n(\varphi(B_r(x)))}{m_n(B_r(0))}\virgola
	\end{equation*}
	da cui, applicando il \cref{lemma:LimiteDeterminante}, otteniamo che per quasi ogni $x$ nella parte interna di $K$
	\begin{equation}\label{eq:DisuguaglianzaRadonNikodym}
		\rho(x)\le \lvert \det D\varphi(x)\rvert \punto
	\end{equation}
	Vista l'arbitrarietà della scelta di $K$ abbiamo dimostrato che fissato un qualunque compatto, per quasi ogni valore $x$ nella sua parte interna, vale l'\cref{eq:DisuguaglianzaRadonNikodym}. 
	
	Chiamiamo $N\subseteq\Omega$ l'insieme degli $x$ per cui non è valida l'\cref{eq:DisuguaglianzaRadonNikodym} e sia $(K_n)_{n\in\N}$ una successione di compatti, tali che $K_n\subseteq \mathring K_{n+1}$, la cui unione \emph{crescente} è $\Omega$\footnote{È un risultato elementare di topologia reale, noto come esaustione tramite compatti, l'esistenza di una tale successione di compatti per ogni aperto.}.
	Ogni elemento $x\in\Omega$ è definitivamente contenuto nella parte interna di $K_n$, quindi risulta
	\begin{equation*}
		N=N\cap\Omega=N\cap\bigcup_{n\in\N} \mathring K_n=\bigcup_{n\in\N}N\cap\mathring K_n\virgola
	\end{equation*}
	che, poiché $N\cap\mathring{K_n}$ è trascurabile per quanto affermato sopra, dimostra che $N$ è trascurabile.
	
	Ma il fatto che $N$ sia trascurabile implica che l'\cref{eq:DisuguaglianzaRadonNikodym} vale per quasi ogni $x\in\Omega$ e ciò, unito all'\cref{eq:CambioRadonNikodym}, implica che per ogni $f:\Omega\to\Rbar$ misurabile positiva vale
	\begin{equation*}
		\forall E\in \M_n\virgola E\subseteq\Omega:\ \int_{\varphi(E)} f(y)\de y\le 
		\int_E f(\varphi(x))\left\lvert\det D\varphi(x)\right\rvert\de x \punto
	\end{equation*}
	
	Ora giungiamo alla disuguaglianza conclusiva applicando quest'ultima stima sia alla funzione $\varphi$ sia alla funzione $\varphi^{-1}$ che, essendo per ipotesi anch'esso un diffeomorfismo $C^1$, rispetterà un analogo enunciato.
	Seguendo lo schema annunciato otteniamo che per ogni $E\subseteq\Omega$ misurabile vale
	\begin{multline*}
		m_n(E) =\int_{\varphi(\varphi^{-1}(E))}1\de x\le \int_{\varphi^{-1}(E)} \left\lvert\det D\varphi(x)\right\rvert\de x \\
 		\le \int_E \left\lvert\det D\varphi(\varphi^{-1}(x))\right\rvert \cdot \left\lvert\det D\varphi^{-1}(x)\right\rvert\de x =\int_E 1\de x=m_n(E) \virgola
	\end{multline*}
	dove abbiamo applicato implicitamente la formula del differenziale dell'inversa e la moltiplicatività del determinante.
	Però, poiché primo e ultimo membro coincidono, tutte le disuguaglianze della catena devono essere uguaglianze e da questo ricaviamo
	\begin{equation*}
		m_n(E)=\int_{\varphi^{-1}(E)} \left\lvert\det D\varphi(x)\right\rvert\de x \virgola
	\end{equation*}
	che implica banalmente la tesi.
\end{proof}

\begin{theorem}\label{thm:CambioVariabile}
	Fissati $\Omega,\Omega'\subseteq\R^n$ due aperti, sia $\varphi:\Omega\to\Omega'$ un diffeomorfismo $C^1$.
	Allora, per ogni $E\subseteq \Omega$ misurabile e $f:\Omega'\to\Rbar$ integrabile, vale
	\begin{equation*}
		\int_{\varphi(E)} f(y)\de m_n(y) = \int_{E} f(\varphi(x))\lvert \det D\varphi(x) \rvert \de m_n(x) \virgola
	\end{equation*}
	dove $D\varphi$ è la matrice jacobiana del diffeomorfismo $\varphi$.
\end{theorem}
\begin{proof}
	È un'ovvia conseguenza della \cref{prop:IdentitaMisuraImplicaCambioVariabile}, visto che le ipotesi di questa sono verificate dal \cref{lemma:MisuraImmagine}.
\end{proof}

Ci si accorge subito, svolgendo qualche esercizio in cui è richiesto di applicare il cambio di variabile, che è spesso ostico applicare il \cref{thm:CambioVariabile} in quanto richiede ipotesi molto stringenti (in particolare il fatto che $\varphi$ sia un diffeomorfismo tra aperti). 
Diamo quindi ora una versione più \emph{sporca}, ma più utile nella pratica, del medesimo teorema mettendo in luce una delle idee chiave della teoria della misura: gli insiemi trascurabili sono davvero trascurabili.

\begin{corollary}\label{cor:CambioVariabileSporco}
	Sia $\varphi:A\to\R^n$ una funzione localmente lipschitziana con $A$ sottoinsieme di $\R^n$.
	Assumiamo che esista un aperto $\Omega\subseteq A$ tale che valgano le seguenti proprietà:
	\begin{enumerate}
		\item L'insieme $A\setminus \Omega$ è trascurabile;
		\item La funzione $\varphi$ ridotta su $\Omega$ ha regolarità $C^1$;
		\item I punti $x\in\Omega$ tali che il differenziale di $\varphi$ non sia iniettivo formano un insieme trascurabile.
	\end{enumerate}
	
	Allora, per ogni insieme misurabile $E\subseteq \varphi(A)$ e per ogni $f:E\to\Rbar$ integrabile, vale la formula per il cambio di variabile
	\begin{equation*}
		\int_{\varphi(E)} f(y)\de m_n(y) = \int_{E} f(\varphi(x))\lvert \det D\varphi(x) \rvert \de m_n(x) \virgola
	\end{equation*}
	dove $D\varphi$ è la matrice jacobiana del diffeomorfismo $\varphi$.
\end{corollary}
\begin{proof}
	Definiamo $C\subseteq\Omega$ l'insieme di punti $x\in\Omega$ tali che il differenziale di $\varphi$ in $x$ non è iniettivo. 
	L'insieme $C$ è per ipotesi trascurabile.
	Inoltre, per le proprietà del determinante, vale l'identità insiemistica
	\begin{equation*}
		C=\left\{x\in\Omega:\det D\varphi(x)=0\right\}
	\end{equation*}
	e perciò l'insieme $C$ risulta essere chiuso in quanto coincide con l'insieme degli zeri di una funzione continua (il determinante è continuo, ed anche $D\varphi$ lo è per ipotesi).
	Allora abbiamo dimostrato che $C$ è un chiuso trascurabile.
	
	Definiamo ora $\overline\Omega=\Omega\setminus C$. 
	Per quanto detto su $C$ l'insieme $\overline\Omega$ è un aperto e l'insieme $A\setminus\overline\Omega$ è trascurabile, in quanto è un sottoinsieme di $(A\setminus\Omega)\cup C$ che è per ipotesi trascurabile.
	
	Definiamo inoltre $\overline E=E\cap\overline\Omega$. 
	Vale, grazie alle proprietà di $\overline\Omega$ evidenziate, la catena di contenimenti insiemistici
	\begin{equation*}
		E\setminus\overline E=E\setminus\overline\Omega\subseteq A\setminus\overline\Omega
	\end{equation*}
	e questa dimostra che $E\setminus\overline E$ è trascurabile in quanto sottoinsieme di un trascurabile.
	
	Inoltre, essendo $\varphi$ localmente lipschitziana per ipotesi, in virtù del \cref{cor:LocLipschitzTengonoMisurabili}, anche l'immagine di $E\setminus\overline E$ tramite $\varphi$ risulta essere trascurabile. Di conseguenza anche l'insieme $\varphi(E)\setminus\varphi(\overline E)$ è trascurabile in quanto è un sottoinsieme di $\varphi(E\setminus\overline E)$.
	
	Per concludere le definizioni, chiamiamo $\overline\varphi:\overline\Omega\to\overline\Omega'=\varphi(\overline\Omega)$ la restrizione di $\varphi$ all'aperto $\overline\Omega$.
	La funzione $\overline\varphi$ è $C^1$ in quanto restrizione ad un aperto di una $C^1$ e, per la definizione di $\overline\Omega$, ha differenziale iniettivo in ogni punto.
	Ma allora, per il teorema di inversione locale\footnote{Tale teorema, vero in una forma più generale di quelle qui usata, afferma che una funzione $C^1$ con differenziale bigettivo in un punto ammette un'inversa locale in quel punto anch'essa $C^1$.} applicato a $\overline\varphi$ in ogni punto di $\overline\Omega$, ne deduciamo che $\overline\Omega'$ è un aperto e $\overline\varphi$ è un diffeomorfismo $C^1$.
	
	Ricordando le proprietà di $\overline\varphi$, $\overline\Omega$ e $\overline E$ evidenziate, il \cref{cor:IntegraleAMenoDiTrascurabili} e, nell'identità centrale, il \cref{thm:CambioVariabile} (di cui abbiamo verificato tutte le ipotesi), otteniamo la tesi attraverso la catena d'uguaglianze
	\begin{multline*}
		\int_{\varphi(E)} f(y)\de y=\int_{\varphi(\overline E)} f(y)\de y+\int_{\varphi(\overline E)\setminus\varphi(E)}f(y)\de y \\
		=\int_{\overline\varphi(\overline E)} f(y)\de y=\int_{\overline E} f(\overline\varphi(x))\lvert \det D\overline\varphi(x) \rvert \de x \\
		=\int_{\overline E}f(\varphi(x))\lvert \det D\varphi(x) \rvert \de x+
		 \int_{E\setminus\overline E}f(\varphi(x))\lvert \det D\varphi(x) \rvert \de x=\int_{E}f(\varphi(x))\lvert \det D\varphi(x) \rvert \de x \punto
	\end{multline*}
\end{proof}

\begin{exercise}
	Calcolare il volume della palla unitaria di $\R^3$.
\end{exercise}
\begin{proof}
	Chiamiamo $B$ la palla chiusa di raggio $1$ centrata nell'origine di $\R^3$.
	Chiamiamo $\varphi:\cc{0}{1}\times\cc{0}{\pi}\times\cc{0}{2\pi}\to B$ la funzione definita come
	\begin{equation*}
		\varphi(r,\theta,\phi)=(r\cos\theta,r\sin\theta\cos\phi,r\sin\theta\sin\phi)\punto
	\end{equation*}
	La funzione $\varphi$ è suriettiva, ed è anche iniettiva a meno di non considerare i punti $(r,\theta,\phi)$ in cui una delle variabili assume uno dei suoi due valori estramali.
	
	Facendo qualche derivata parziale, calcoliamo che lo Jacobiano vale
	\begin{equation*}
		D\varphi=
		\begin{pmatrix}
		\cos\theta 			&	-r\sin\theta		&	0						\\
		\sin\theta\cos\phi	&	r\cos\theta\cos\phi	&	-r\sin\theta\sin\phi	\\
		\sin\theta\sin\phi	&	r\cos\theta\sin\phi	&	r\sin\theta\cos\phi
		\end{pmatrix}
	\end{equation*}
	e di conseguenza otteniamo
	\begin{equation*}
		\det D\varphi(r,\theta,\phi)= r^2\sin\theta \punto
	\end{equation*}
	
	Ora è facile verificare che la funzione $\varphi$ rispetta tutte le richieste del \cref{cor:CambioVariabileSporco} e di conseguenza, applicando la formula per il cambio di variabile ed il \cref{thm:TonelliCompleto}, otteniamo
	\begin{multline*}
		m_3(B)=\int_B \de(x,y,z)=\int_{\varphi\left(\cc{0}{1}\times\cc{0}{\pi}\times\cc{0}{2\pi}\right)}\de(x,y,z)\\
		=\int_{\cc{0}{1}\times\cc{0}{\pi}\times\cc{0}{2\pi}} \lvert r^2\sin\theta\rvert\de(r,\theta,\phi)=\int_0^1\int_0^\pi\int_0^{2\pi}\lvert r^2\sin\theta\rvert\de r\de\theta\de\phi\\
		=2\pi\left(\int_0^1 r^2\de r\right)\left(\int_0^\pi\sin\theta\de\theta\right)=2\pi\cdot\frac 13\cdot 2=\frac 43\pi
	\end{multline*}
	che è proprio il volume richiesto dall'esercizio.
\end{proof}
\begin{remark}\label{nota:CoordinateSferiche}
	Il cambio di variabile che associa alla tripla $(r,\theta,\phi)$ il punto di $\R^3$ con coordinate $(r\cos\theta,r\sin\theta\cos\phi,r\sin\theta\sin\phi)$ è noto con il nome di coordinate sferiche.
	
	Questo cambio di variabile è spesso utile nel calcolo di integrali in $\R^3$ poiché il determinante dello Jacobiano è straordinariamente semplice e permette quindi di sfruttare, evitando lunghi conti, le eventuali simmetrie che un problema può presentare.
\end{remark}


