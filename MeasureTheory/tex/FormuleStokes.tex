\section{Formule di Stokes}\label{sezione:FormuleStokes}

Iniziamo con lo studio degli insiemi regolari che ci interessano per il teorema di Stokes.
A questo proposito, durante tutta la sezione assumeremo sempre che $\Omega\subseteq\R^n$ sia un aperto limitato.

\begin{theorem}\label{thm:PtRegEquiv}
	Per un punto $\bar x\in \partial \Omega$ le seguenti tre condizioni sono equivalenti:
	\begin{enumerate}
		\item esistono $U$ intorno di $\bar x$ e $f\in C^1(U,\R)$ tale che si abbia
			\begin{itemize}
				\item $U\cap \partial \Omega=f^{-1}(0)$,
				\item $U\cap \Omega=f^{-1}(\oo{-\infty}{0})$,
			\end{itemize}
			e tale che $\grad f(x)\neq 0$ se $f(x)=0$;\label{PRE:i}
		\item esistono $U$ intorno di $\bar x$ e $g$ diffeomorfismo $C^1$ da $\R^n$ in $U$ tale che\label{PRE:ii}
			\begin{itemize}
				\item $U\cap \partial \Omega = g(\R^{n-1}\times\{0\})$,
				\item $U\cap \Omega = g(\R^{n-1}\times\oo{-\infty}{0})$;
			\end{itemize}
		\item esistono, a meno di riordinare le coordinate, un intorno $U=V\times I$ di $\bar x=(\bar v,\bar t)$ tale che $V\in\R^{n-1}$ è intorno di $y$
			e $I\in\R$ è intorno di $t$ e una funzione $\psi\in C^1(V,I)$ tale che
			\begin{itemize}
				\item $U\cap \partial \Omega = \{(v,t)\in V\times I: t=\psi(v)\}$,
				\item $U\cap \Omega = \{(v,t)\in V\times I:t<\psi(v)\}$.
			\end{itemize}\label{PRE:iii}
	\end{enumerate}
\end{theorem}

\begin{proof}
	Dimostriamo la catena in ordine inverso:
	\begin{description}
		\item [\ImplicationProof{PRE:i}{PRE:iii}] Dato che $\grad f(\bar x)\neq 0$, esiste una derivata parziale non nulla, supponiamo senza perdita
			di generalità che sia l'ultima e che sia positiva (se negativa il ragionamento è lo stesso).
			Allora le ipotesi del teorema della funzione implicita del Dini sono verificate, otteniamo quindi
			che esiste un intorno $V\times I\subseteq U$ di $\bar x$, con $V\in\R^{n-1}$ e $I\in\R$, per cui esiste $\psi\in C^1(V,I)$ tale che, per ogni $v\in V$, $f(v,\psi(v))=0$ e $\psi(v)$
			è l'unico punto $t'\in I$ tale che $f(v,t')=0$.
			Inoltre, per la continuità di $\grad f(x)$, esiste un intorno $V'\subseteq V$ di $\bar v$, con $\bar x=(\bar v, \psi(\bar v))$, tale che $\grad f(v',\psi(v'))_n>\frac{1}{2}
			\grad f(\bar x)_n$ per tutti i $v'\in V'$. 
			
			Ora, per la differenziabilità di $f$ in $(v',\psi(v'))$ si ha, per $\delta\in \R$,
			\[
				f(v',\psi(v')+\delta)=f(v', \psi(v'))+\grad f(v',\psi(v'))_n\delta+\smallO(\delta)=\grad f(v',\psi(v'))_n\delta+\smallO(\delta)\virgola
			\]
			che, per $\delta>0$ e abbastanza piccolo, dà
			\begin{equation*}
				f(v',\psi(v')+\delta)\geq \frac{1}{2}\grad f(v',\psi(v'))_n\delta\geq \frac{1}{4}\grad f(\bar x)_n\delta>0\punto
			\end{equation*}
			
			Infine, non può esistere un $\delta>0$ tale che $\psi(v')+\delta\in I$ e
			$f(v',\psi(v')+\delta)<0$, altrimenti per la continuità di $f$ si avrebbe che esiste un punto $\psi(v')+\delta'\neq \psi(v')$
			che sia zero per la funzione $f(v',\cdot)$, contraddicendo il teorema della funzione implicita del Dini.
			Per $\delta<0$ si ha lo stesso risultato. Questo ci dice che 
			\begin{align*}
				f^{-1}(0)\cap (V'\times I)&=\{(v',t)\in V'\times I:t=\psi(v')\} \virgola\\
				f^{-1}(\oo{-\infty}{0})\cap (V'\times I)&=\{(v',t)\in V'\times I:t<\psi(v')\}\virgola
			\end{align*}
			che conclude per le ipotesi sulle controimmagini di $f$.
		\item [\ImplicationProof{PRE:iii}{PRE:ii}] Se abbiamo $V\times I$ intorno di $\bar x$ e $\psi\in C^1(V,I)$ come nelle ipotesi, detto $J=\oo{-\varepsilon}{\varepsilon}$
			possiamo ottenere un diffeomorfismo $g:V\times I \rightarrow V\times J$ ponendo $g(v,t)=(v,t-\psi(v))$. 
			Di conseguenza otteniamo
			\begin{align*}
				g(V\times \{0\})&=\graf(\psi)=U\cap \partial \Omega \virgola\\
				g(V\times \oo{-\varepsilon}{0})&=\{(v,t)\in V\times I:t<\psi(v)\}=U\cap \Omega\punto
			\end{align*}
			Per ottenere un diffeomorfismo di tutto $\R^n$ basta comporre $g$ con opportuni diffeomorfismi tra un intorno rettangolare
			di $\bar x$ e $\R^n$.
		\item [\ImplicationProof{PRE:ii}{PRE:i}] È sufficiente scegliere $f=(g^{-1})_n$; infatti, $g^{-1}$ va da $U$ in $\R^n$ e, essendo un diffeomorfismo, ha differenziale invertibile in ogni punto.
			In particolare, ogni riga della matrice del differenziale non è nulla (quindi neanche $\nabla f$) e le condizioni sulla $g$ si traducono immediatamente in quelle chieste alla $f$:
			\[
				U\cap \partial \Omega = g(\R^{n-1}\times\{0\}) \Rightarrow g^{-1}(U\cap \partial \Omega) = \R^{n-1}\times\{0\}\virgola
			\]
			cioè $(g^{-1})_n(\R^{n-1}\times\{0\}) = \{0\}$. E lo stesso per i negativi.
	\end{description}
\end{proof}


\begin{definition}[Punto regolare]
	Diremo che un punto $x\in \partial \Omega$ è un punto regolare del bordo se verifica una delle tre condizioni di cui
	al \cref{thm:PtRegEquiv}.
\end{definition}

Abbiamo quindi definito il tipo di regolarità che serve ai nostri scopi. Ma questa, ancora, è una nozione locale. Diamo allora la definizione globale.

\begin{definition}[Aperto regolare]
	Diremo che $\Omega$ è un aperto regolare se tutti i punti del suo bordo sono regolari.
\end{definition}

Questi insiemi saranno di cruciale importanza perché i principali risultati di questa sezione riguardano tutti insiemi di questo tipo.

Facciamo ora una piccola parentesi per introdurre uno strumento molto utile per estendere funzioni definite solo localmente a funzioni in tutto lo spazio. Tale teorema sarà utilizzato in più punti della sezione.

\begin{theorem}[Partizione dell'unità]\label{thm:PartizioneUnita}
	Dato un ricoprimento di $\R^n$ con aperti $(\Omega_i)_{i\in I}$, esiste una famiglia di funzioni $f_i:\R^n\to\Rpiu$ infinitamente derivabili
	e non negative tali che:
	\begin{itemize}
		\item la chiusura dell'insieme in cui $f_i$ non si annulla è contenuta in $\Omega_i$ per ogni $i\in I$,
		\item per ogni $x\in\R^n$ vale che $\sum_{i\in I} f_i(x)=1$\footnote{La serie la definiamo come il $\sup$ delle somme finite.}.
	\end{itemize}
\end{theorem}
\begin{proof}
	TODO
\end{proof}

Mostriamo ora, facendo uso di questo teorema, che è possibile dare una definizione di aperto regolare che coinvolga una sola funzione definita globalmente.

\begin{lemma}\label{lemma:EquivRegolare}
	Abbiamo che $\Omega$ è un aperto regolare se e solo se esiste una funzione $\phi\in C^1(\R^n,\R)$ tale che $\grad \phi(x)\neq 0$ se $\phi(x)=0$ e tale che
	\begin{itemize}
		\item $\Omega = \phi^{-1}(\oo{-\infty}{0})$,
		\item $\partial \Omega = \phi^{-1}(0)$.
	\end{itemize}
\end{lemma}

\begin{proof}
	L'implicazione del ``se'' è banale per la caratterizzazione del punto \ref{PRE:i}, dimostriamo quindi l'altra implicazione. 
	
	Per la regolarità dei punti
	del bordo di $\Omega$, consideriamo per ogni $x\in\partial \Omega$ un intorno $U_x$ tale che esista una funzione $\psi_x:U_x\rightarrow \R$
	come nel punto \ref{PRE:iii} del \cref{thm:PtRegEquiv}. Dato che $\Omega$ è limitato, $\partial\Omega$ è compatto e gli $U_x$ sono un ricoprimento aperto di $\partial \Omega$; possiamo
	quindi estrarre un sottoricoprimento finito $U_1, \dots, U_n$ di $\partial\Omega$. Chiamando $U_0 = \R^n \setminus \partial \Omega$,
	abbiamo perciò che gli aperti $U_0,\dots,U_n$ sono un ricoprimento di $\R^n$ e di conseguenza
	il \cref{thm:PartizioneUnita} ci fornisce delle funzioni $f_i$ per ogni $i\in\{0,\dots, n\}$ con tutte le proprietà descritte.
	Infine, definiamo $\psi_0:U_0\rightarrow \R$ tale che $\psi_0(x)=1$ se $x\notin \Omega$, $\psi_0(x)=-1$ altrimenti (per ognuno degli altri $U_i$ abbiamo già delle funzioni $\psi_i$). Sia ora 
	\[
		\phi(x)=\sum_{i=0}^n f_i(x) \psi_i(x)\virgola
	\]
	dove, con una leggera imprecisione formale, poniamo $f_i(x) \psi_i(x) = 0$ se $x\notin U_i$, in modo che $f_i(x) \psi_i(x)$ sia una funzione
	$C^1$ in tutto $\R^n$. Infatti, dove sono definite entrambe (cioè in $U_i$), $f_i(x)\psi_i(x)$ è $C^1$, perchè $\psi_i$ è $C^1$ e $f_i$ è addirittura $C^{\infty}$; inoltre la chiusura dell'insieme in cui $f_i$ non si annulla è contenuta in $U_i$ e perciò non ci sono problemi nel passaggio all'esterno di $U_i$, dove abbiamo posto il prodotto uguale a 0.
	
	Ora abbiamo che $\phi\in C^1$ perché somma di funzioni $C^1$; $\phi(x)=0$ per ogni $x\in \partial\Omega$, dato che ognuna delle
	$\psi_i$ aveva questa proprietà se era definita in $x$;
	$\phi(x)<0$ per ogni $x \in \Omega$, perché $\phi$ è combinazione convessa di funzioni che, per ciascun $x\in\Omega$, sono non positive e
	delle quali almeno una strettamente negativa; similmente, $\phi(x)>0$ per ogni $x \notin \overline\Omega$.
	
	Rimane da mostrare che $\grad \phi(x)\neq 0$ se $\phi(x)=0$. Ancora una volta utilizzeremo che $\phi$ è una combinazione convessa delle $\psi_i$, quindi vorremmo mostrare che il gradiente di ciascuna di queste è non nullo e che nei punti di sovrapposizione tali gradienti sono concordi a due a due.
	
	In ciascun punto $x$ del bordo, le funzioni $\psi_i$ non hanno differenziale nullo quando sono definite in $x$, per la regolarità dei punti del bordo. Esisterà quindi una direzione $e_k$ per la quale esiste almeno un $i$ tale che $\grad \psi_i(x)_k\neq 0$.
	Dato che le $\psi_i$ sono differenziabili, si ha che
	\[
		\psi_i(x+\delta e_k)=\psi_i(x)+\grad \psi_i(x)_k \delta + \smallO(\delta) = \grad \psi_i(x)_k \delta + \smallO(\delta)\punto
	\]
	Sapevamo però che, per ciascun indice $i$, $\psi_i(x+\delta e_k)<0$ solo se $x+\delta e_k\in \Omega$.
	Quindi, per $i\neq i'$, $\grad \psi_i(x)_k$ e $\grad \psi_{i'}(x)_k$ non possono essere discordi, altrimenti si ha che uno tra $\psi_i(x+\delta e_k)= \grad \psi_i(x)_k \delta + \smallO(\delta)$ e
	$\psi_i'(x+\delta e_k)=\grad \psi_i'(x)_k \delta + \smallO(\delta)$ è positivo per $\delta$ sufficientemente piccolo, ma questo sarebbe assurdo perchè in entrambi i casi $x+\delta e_k$ sta in $\Omega$.
	
	Quindi, sempre per lo stesso $x\in\partial \Omega$, utilizzando che $\psi_i\equiv 0$ sul bordo, otteniamo
	\[ 
		\grad \phi(x)=\sum_{i=0}^n \grad (f_i \cdot\psi_i)(x)=\sum_{i=0}^n \grad f_i(x)\cdot \psi_i(x)+\sum_{i=0}^n f_i(x)\cdot \grad \psi_i(x)=
		\sum_{i=0}^n f_i(x)\cdot \grad  \psi_i(x)\punto
	\]
	Perciò $\grad \phi(x)$ non è nullo perché la $k$-esima componente è combinazione convessa di
	$\grad \psi_i(x)_k$ che sono non discordi.
\end{proof}

La conseguenza più importante dell'esistenza di un'unica funzione $\phi$ che discrimina punti interni ed esterni ad $\Omega$ è certamente la seguente.

\begin{definition}[Campo normale esterno]
	Data la $\phi$ di cui al \cref{lemma:EquivRegolare}, chiamiamo campo normale esterno la funzione $\nu:\partial\Omega\rightarrow \R^n$ tale che
	\[
		\nu(x)=\frac{\grad \phi(x)}{\lVert\grad \phi(x)\rVert}\punto
	\]
\end{definition}

\begin{remark}
	Il \cref{lemma:EquivRegolare}, oltre che a fornire la funzione $\phi$ per l'aperto regolare $\Omega$, dice anche che $\nu(x)$ è ben definita
	su tutto $\partial \Omega$ e che è continua.
\end{remark}

\begin{remark}
	Si ha che per $t>0$ e $x\in\partial\Omega$, $x+t\nu(x)\notin \Omega$ per $t$ abbastanza piccoli e per $t<0$, $x+t\nu(x)\in \Omega$ per $t$
	abbastanza piccoli.
\end{remark}
\begin{proof}
	Stesso ragionamento fatto nella dimostrazione del \cref{lemma:EquivRegolare}.
\end{proof}

Forti di una solida definizione di campo normale uscente possiamo procedere con il formalizzare la definizione di integrale sulla superficie $\partial\Omega$ sfruttando anche i risultati della sezione precedente.

\begin{lemma}\label{lemma:GrapVar}
	Sia $V\in\R^{n-1}$ aperto e $f\in C^1(V,\R)$, allora il grafico di $f$ è una varietà differenziabile di dimensione $n-1$ immersa in $\R^n$.
\end{lemma}
\begin{proof}
	Sia $g:V\rightarrow \R^n$ data da $g(x)=(x,f(x))$. Ora è chiaro che $\graf(f)$ è l'immagine di $g$; inoltre $g$ è banalmente di classe $C^1$
	e, se vista come funzione da $V$ in $\graf(f)$, è anche un omeomorfismo. Infine $\Diff g(x)[h]=(h,\Diff f(x)[h])$, perciò in particolare il differenziale di $g$ è
	iniettivo in ogni punto. Quindi $g$ è una immersione iniettiva, cioè è una parametrizzazione $C^1$ di $\graf(f)$.
\end{proof}

\begin{remark}
	Dalla dimostrazione di questo lemma, dato che $\grad f(x)=\Diff f(x)$, segue immediatamente che $\Diff g(x)^T \Diff g(x)=
	(I \ \ \grad f(x)^T)
	\left(\begin{smallmatrix}
	I \\
	\grad f(x)
	\end{smallmatrix}\right)$, quindi per il \cref{lemma:DeterminanteMatriceQuasiIdentita} vale che $\det (\Diff g(x)^T \Diff g(x)) = 1+\lVert\grad f(x)\rVert^2$. 
\end{remark}

Il \cref{lemma:GrapVar} ci permette quindi di costruire un misura superficiale su $\graf(f)$ in accordo con la \cref{def:MisuraKDimensionale}:
\begin{equation}\label{eq:MisuraSuperficialeGrafico}
	\sigma(E)=\int_{g^{-1}(E)} \sqrt{1+\lVert\grad f(x)\rVert^2} \de x\punto
\end{equation}


Ora che sappiamo cos'è la normale uscente ad un aperto regolare e sappiamo come intendere l'integrale sulla sua superficie,
abbiamo ottenuto tutti gli strumenti che ci servono per formalizzare il principale risultato della sezione. Possiamo quindi enunciare il teorema di Stokes.

\begin{theorem}[Formula di Stokes]\label{thm:Stokes}
	Sia $u\in C^1(\overline\Omega,\R)$ (ossia $u$ è la restrizione a $\overline\Omega$ di una funzione $C^1$ definita su un aperto
	$\Omega'\supseteq \overline\Omega$) e sia $\nu:\partial \Omega \rightarrow \R^n$ la normale uscente da $\Omega$, allora vale che
	\begin{equation}\label{eq:FormulaStokes}
		\int_{\Omega} \grad u(x)_j \de x = \int_{\partial \Omega} u(y)\nu(y)_j \de \sigma(y)\punto
	\end{equation}
\end{theorem}

\begin{proof}
	Per la dimostrazione procederà in due step:
	\begin{enumerate}
		\item per ogni $p\in \overline\Omega$ esiste un intorno aperto rettangolare $U_p=\prod_{i=1}^n \oo{p_i-\varepsilon_i}{p_i+\varepsilon_i}$
			tale che l'\cref{eq:FormulaStokes} vale per ogni funzione $u$ tale che $\supp(u)\subseteq U_p$;
		\item il compatto $\overline\Omega$ si può ricoprire con un numero finito di intorni come sopra, quindi si applica il \cref{thm:PartizioneUnita} per ottenere
			la tesi per ogni $u$.
	\end{enumerate}
	
	Dimostriamo quindi il primo punto, distinguendo i casi in cui $p\in \Omega$ e $p\in \partial \Omega$.
	Se $p\in \Omega$ esiste un intorno rettangolare $U_p=V\times \oo{a}{b}$ di $p$ (con $V\subseteq \R^{n-1}$) contenuto in $\Omega$, poiché quest'ultimo è un aperto. Se ora $\supp(u)\subseteq U_p$,
	allora $u(\partial \Omega)=0$; quindi abbiamo che l'integrale a destra è $0$. Per l'integrale a sinistra, invece, abbiamo che una funzione $u$
	con supporto contenuto in $V\times \oo{a}{b}$ è tale che $u(x)=0$ per ogni
	$x\in \partial (V\times \oo{a}{b})$. Allora, per il \cref{thm:Fubini} e il teorema fondamentale del calcolo integrale, vale che
	\begin{align*}
		\int_{\Omega} \grad u(x)_n \de x &= \int_{V\times \oo{a}{b}} \grad u(v,t)_n \de (v,t) = \\
		& = \int_V \int_a^b \grad u(v,t)_n \de t \de v = \int_V (u(v,b) - u(v,a)) \de v = 0\punto
	\end{align*}
	Quindi abbiamo la tesi del primo punto quando $p\in\Omega$. Se invece $p\in \partial \Omega$, allora $p$ è un punto regolare, cioè esiste
	un intorno $U_p=V\times I$ di $p$ e una $\psi\in C^1(V,I)$ tale che
	\begin{itemize}
		\item $U_p\cap \partial \Omega = \{(v,t)\in V\times I:t=\psi(v)\}$,
		\item $U_p\cap \Omega = \{(v,t)\in V\times I:t<\psi(v)\}$.
	\end{itemize}
	Distinguiamo ora i casi $j=n$ e $j\neq n$.
	\begin{description}
		\item [$j=n$:] Dato che stiamo supponendo che $\supp(u)\subseteq U_p$, per il \cref{thm:Fubini} abbiamo che
			\begin{align*}
				\int_{\Omega} \grad u(x)_n \de x  &= \int_{\Omega\cap U_p} \grad u(v,t)_n\de (v,t) =
				\int_{U_p} \grad u(v,t)_n \chi_{\{t<\psi(v)\}} \de (v,t) = \\
				& = \int_V \int_I \grad u(v,t)_n \chi_{\{t<\psi(v)\}} \de t \de v =
				\int_V \int_{-\infty}^{\psi(v)} \grad u(v,t)_n \de t \de v = \\
				& = \int_V (u(v,\psi(v)) - 0) \de v = \int_V u(v,\psi(v)) \de v\punto
			\end{align*}
			
			Ora abbiamo che la funzione $g:V\rightarrow \R^n$ data da $g(v)=(v,\psi(v))$ parametrizza l'ipersuperfice data dal grafico di
			$\psi$, quindi la misura superficiale è data dall' \cref{eq:MisuraSuperficialeGrafico}.
			Inoltre, detta $\nu:\partial \Omega \cap U_p \rightarrow \R^n$ la normale uscente da $\Omega$, sappiamo che
			$\nu(v,\psi(v))_n=(1+\lVert\grad\psi(v)\rVert^2)^{-\frac{1}{2}}$. Quindi per definizione di integrale superficiale abbiamo che
			\begin{align*}
				\int_V u(v,\psi(v)) \de v &= \int_V u(v,\psi(v)) (1+\lVert\grad\psi(v)\rVert^2)^{-\frac{1}{2}} (1+\lVert\grad\psi(v)\rVert^2)^{\frac{1}{2}} \de v = \\
				& = \int_V u(v,\psi(v)) \nu(v,\psi(v))_n (1+\lVert\grad\psi(v)\rVert^2)^{\frac{1}{2}} \de v = \\
				& = \int_{\partial \Omega \cap U_p} u(x) \nu(x)_n \de \sigma(x) = \\
				& = \int_{\partial \Omega} u(x) \nu(x)_n \de \sigma(x)\virgola
			\end{align*}
			dove nell'ultimo passaggio si è usato che $\supp(u)\subseteq U_p$.
		\item [$j\neq n$:] Possiamo assumere (a meno di riordinare le coordinate) che $j=n-1$ e, a meno di considerare un intorno più piccolo,
			che $V=W \times J$. Ora, per il \cref{thm:Fubini}, abbiamo che
			\[
				\int_{\Omega} \Diff u(x)_{n-1} \de x = \int_W \int_J \int_I \Diff_s u(w,s,t) \de t \de s \de w\punto
			\]
			Inoltre, dato che $\Diff_s \int_X u(v,s)\de v = \int_X \Diff_s u(v,s)\de v$ e che $\Diff_y \int_a^y u(v,t)\de t=u(v,y)$,
			utilizzando le regole di composizione del differenziale, abbiamo che
			\[
				\Diff_s \int_{-\infty}^{\psi(w,s)} u(w,s,t) \de t =
				\int_{-\infty}^{\psi(w,s)} \Diff_s u(w,s,t) \de t + u(w,s,\psi(w,s))\Diff_s \psi (w,s)\punto
			\]
			Per cui, integrando il termine a sinistra su $V=W\times J=W\times \oo{a}{b}$, per il teorema fondamentale del
			calcolo integrale,
			\begin{align*}
				&\int_W \int_a^b \Diff_s \int_{-\infty}^{\psi(w,s)} u(w,s,t) \de t \de s \de w = \\
				&\int_W \left(\int_{-\infty}^{\psi(w,b)} u(w,b,t) \de t - \int_{-\infty}^{\psi(w,a)} u(w,a,t) \de t\right) \de w
				= 0\virgola
			\end{align*}
			poiché i punti $(w,b,t)$ e $(w,a,t)$ sono sul bordo di $U$, dove la funzione $u$ è nulla per ipotesi. Usando questa relazione
			otteniamo che
			\[
				\int_W\int_J\int_I\Diff_s u(w,s,t) \de t \de s \de w =-\int_W \int_J u(w,s,\psi(w,s))\Diff_s \psi (w,s)\de s\de w\punto
			\]
			Ora, dato che $\nu(x)_{n-1}=\nu(v,\psi(v))_{n-1}=-\Diff\psi(v)_{n-1}(1+\psi(v)^2)^{-\frac{1}{2}}$, otteniamo
			\begin{align*}
				\int_{\Omega} \Diff_{n-1} u(x)_{n-1} \de x & = -\int_W \int_J u(w,s,\psi(w,s))\Diff_s \psi (w,s) \de s \de w\\
				& = -\int_V u(v,\psi(v))\Diff_{n-1} \psi(v) \de v\\
				& = -\int_V u(v,\psi(v))(-\nu(v,\psi(v))_{n-1})(1+\psi(v)^2)^{\frac{1}{2}} \de v\\
				& = \int_{\partial \Omega \cap U} u(x)\nu(x)_{n-1} \de \sigma(x)\punto
			\end{align*}
	\end{description}
	Questo conclude il primo punto.
	
	Per la seconda parte procediamo in questo modo.
	Consideriamo, per ogni punto $p\in \overline\Omega$, un intorno $U_p$ della forma richiesta al punto precedente. È chiaro che $\{U_p\}_{p\in\overline\Omega}$ è un
	ricoprimento aperto del compatto $\overline\Omega$, quindi possiamo estrarne un sottoricoprimento finito $U_1,\dots,U_n$, a cui aggiungiamo anche
	$U_0=\R^n \setminus \overline\Omega$. Il \cref{thm:PartizioneUnita} ci fornisce delle funzioni $f_i\in C^{\infty}$, per $0\leq i \leq n$,
	tali che la loro somma è la funzione costante $1$.
	Sia ora $u\in C^1(\R^n,\R)$ una qualsiasi funzione. Otteniamo che
	\[
		u = \sum_{i=0}^n f_i\cdot u\punto
	\]
	Ma quindi ora abbiamo che $f_i \cdot u$ (che è una funzione $C^1$) soddisfa l'\cref{eq:FormulaStokes} per ogni $i$.
	Infatti, per $i=0$, la funzione $f_0\cdot u$ è nulla all'interno di $\overline\Omega$, quindi l'\cref{eq:FormulaStokes} è banalmente soddisfatta; per $i>0$, la funzione $f_i \cdot u$ ha supporto contenuto in $U_p$ per qualche $p\in \overline\Omega$ e, per quanto
	dimostrato nel punto precedente, abbiamo che per questo intorno $U_p$ ogni funzione $C^1$ con supporto al suo interno soddisfa l'\cref{eq:FormulaStokes}.
	
	Per linearità di tutte le espressioni in gioco è chiaro che le funzioni che soddisfano la tesi formano
	un sottospazio vettoriale di $C^1$. Quindi in particolare $u$, essendo combinazione lineare di funzioni appartenenti a questo spazio, soddisfa la formula di Stokes.
\end{proof}

Questo teorema generalizza molti risultati di calcolo vettoriale. Vediamone alcuni.

Un'immediata conseguenza del teorema appena dimostrato è la seguente:

\begin{corollary}(Teorema della divergenza)
	\label{cor:thDivergenza}
	Sia $u:\overline\Omega \rightarrow \R^n$ una funzione $C^1$ (nello stesso senso di prima), allora si ha che
	\begin{equation}\label{eq:thDivergenza}
		\int_{\Omega} \div u (x) \de x = \int_{\partial \Omega} u(y)\cdot\nu(y) \de \sigma(y)\virgola
	\end{equation}
	dove l'operatore di divergenza è definito da $\div u(x)=\tr\Diff u(x)$.
\end{corollary}

\begin{proof}
	Utilizzando il \cref{thm:Stokes} sulla componente $j$-esima di $u$ che indichiamo con $u^j$ si ha che, per ogni $1\leq j\leq n$,
	\[
		\int_{\Omega} \Diff u^j(x)_j \de x = \int_{\partial \Omega} u^j(y)\nu(y)_j \de \sigma(y)\virgola
	\]
	da cui sommando otteniamo, per linearità degli integrali:
	\[
		\int_{\Omega} \sum_{j=1}^n\Diff u^j(x)_j \de x = \int_{\partial \Omega} \sum_{j=1}^n u^j(y)\nu(y)_j \de \sigma(y)\punto
	\]
	Ma ora, $\div u (x)= \tr\Diff u(x) = \sum_{j=1}^n \Diff u^j(x)_j$ e $u(x)\cdot\nu(x)=\sum_{j=1}^n u^j(y)\nu(y)_j$,
	quindi si ha la tesi.
\end{proof}

Giocherellando ancora con queste equazioni si ottengono anche le seguenti formule dette di Green:

\begin{corollary}(Prima formula di Green)
	Siano $u\in C^1(\overline\Omega, \R)$ e $v\in C^2(\overline\Omega, \R)$, allora si ha
	\[
		\int_{\Omega} \left( u \Delta v+ \grad u\cdot\grad v \right) \de x=
		\int_{\partial\Omega} u \frac{\partial v}{\partial \nu} \de \sigma(y) \virgola
	\]
	dove l'operatore $\Delta v = \div \grad v$ è il laplaciano e $\frac{\partial v}{\partial \nu}(x)=\grad v(x)[\nu]$.
\end{corollary}
\begin{proof}
	Dato che
	\begin{equation*}
		\frac{\partial }{\partial j} (u(x)\nabla v(x)_j ) = \frac{\partial u}{\partial j}(x) \nabla v(x)_j + u(x)\frac{\partial}{\partial j}\nabla v(x)_j\virgola
	\end{equation*}
	applicando il \cref{thm:Stokes} sulle funzioni $u(x)\nabla v(x)_j$ otteniamo
	\[
		\int_{\Omega} \left(\frac{\partial u}{\partial j}(x) \nabla v(x)_j + u(x)\frac{\partial}{\partial j}\nabla v(x)_j \right)\de x = 
		\int_{\Omega} \frac{\partial }{\partial j} (u(x)\nabla v(x)_j) \de x =
		\int_{\partial \Omega} u(y)\nabla v(y)_j\nu(y)_j \de \sigma(y)\punto
	\]
	
	Quindi sommando su $j$ otteniamo la tesi, visto che
	\begin{align*}
		&\sum_{j=1}^n \frac{\partial u}{\partial j}(x) \nabla v(x)_j = \sum_{j=1}^n \nabla u(x)_j \nabla v(x)_j = \grad u\cdot\grad v \virgola\\
		&\sum_{j=1}^n u(x)\frac{\partial}{\partial j}\nabla v(x)_j = u \Delta v\virgola\\
		&\sum_{j=1}^n u(y)\nabla v(y)_j\nu(y)_j = u \frac{\partial v}{\partial \nu}\punto
	\end{align*}
\end{proof}

\begin{corollary}(Seconda formula di Green)
	Siano $u,v\in C^2(\overline\Omega, \R)$, allora si ha che
	\[
		\int_{\Omega}\left(u\Delta v-v\Delta u\right) \de x=
		\int_{\partial\Omega}\left(u\frac{\partial v}{\partial\nu}-v\frac{\partial u}{\partial\nu}\right) \de \sigma(y)\punto
	\]
\end{corollary}

\begin{proof}
	Immediata conseguenza della prima formula applicata a $u,v$ e a $v,u$; poi basta sottrarre membro a membro.
\end{proof}


